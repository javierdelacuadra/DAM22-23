registro

1. se pide la clave publica del servidor si no se tiene
2. el usuario se registra con usuario y contraseña
3. se generan clave publica/privada para el usuario
4. se cifra la clave publica del usuario simetricamente con la contraseña del usuario
5. se cifra asimetricamente la contraseña del usuario con la clave publica del servidor que he pedido antes
6. se manda todo el rollo al servidor, que tiene que descifrar la contraseña del usuario con la privada del servidor y luego la publica del usuario con la contraseña del usuario
7. el servidor emite un certificado de la clave publica del usuario con la clave privada del servidor, y guarda la clave publica en el campo contraseña de la base de datos
8. a la vuelta si todo va bien, se guarda en un keystore cuya contraseña es la contraseña del usuario, la privada del usuario y el certificado que trae el servidor
9. y ya ta :)))

login

1. el cliente mete usuario y contraseña
2. la contraseña del usuario se usa para coger la clave privada del usuario que vien del keystore
3. con la clase SecureRandom se crea un string aleatorio, que se firma con la clave privada del usuario que viene del keystore
4. el SERVIDOR recibe el nombre del usuario, el string generado x el secureRandom y la firma
5. con el nombre del usuario se coge la clave pública, y se verifica usando la clave pública, el contenido, y la firma
6. si el verificado da correcto es que el login es correcto 

crud mensajes

1. el contenido del mensaje se cifra simetricamente con la contraseña de la carpeta correspondiente (como antes)

crear carpeta

1. la carpeta tiene nombre y contraseña, y al crear la carpeta se cifra la contraseña con la clave publica del usuario, se guarda cifrada
2. cuando quiero coger las carpetas me trae la contraseña cifrada con la publica del usuario, abro el keystore y descifro la contraseña de la carpeta con la privada del usuario

compartir carpeta

1. tiene que haber una tabla claves donde se guardan todas las claves de todos los usuarios que tengan carpetas compartidas
2. el usuario1 hace una llamada a servidor para determinar que el usuario2 puede acceder a la carpeta x
3. se manda el nombre de la carpeta del usuario1, el nombre del usuario2, y la clave pública del usuario2, que no la tenemos, así que previamente tengo que hacer otra llamada con la pública del usuario2
4. el cliente verifica el certificado que contiene la clave publica del usuario2, con la publica del servidor, ya que el certificado está hecho con la privada del servidor
5. entonces se hace la llamada a servidor del paso 3 que guarda en la tabla de claves la contraseña de la carpeta con la clave publica del usuario que sea, carpeta1 tiene 2 filas, con el mismo nombre, distinto usuario, y misma contraseña cifrada con la clave publica del usuario correspondiente
6. la próxima vez que el usuario2 coja sus carpetas, coge las suyas de la tabla carpetas, y las compartidas de la tabla claves